<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>svg editor</title>
        <style>
            #svg 
            {
                display : block ; 
                /* width : 50% ;  */
                height : 50vh ; 
            }
            #in 
            {
                width : 100% ; 
                height : 20vh ; 
                display : block ; 
                margin : 0 ; 
                padding : 0 ; 
                background-color : #222 ; 
            }
            #in , #in::placeholder 
            {
                color : #fff ; 
            }
        </style>
    </head>
    <body>
        <svg xmlns="http://www.w3.org/2000/svg" id="svg" viewBox="0 0 24 24" fill="#f00" fill-rule="evenodd">
            <path id="preview" d="M0 0h24v24"/>
        </svg>
        <select name="" id="ps">
            <option value="" selected disabled>presets</option>
            <option value="none">none</option>
            <option value="A">甲式圖記</option>
        </select>
        <input type="color" name="" id="color" value="#ff0000" />
        <input type="text" id="vb" placeholder="viewBox" />
        <select name="" id="fr">
            <option value="" selected disabled>fill rule</option>
            <option value="nonzero">non-zero</option>
            <option value="evenodd">even-odd</option>
        </select>
        <textarea id="in" placeholder="M0 0h24v24"></textarea>
        <button id="create">create</button>
        <a id="save" href="test.png" download>save</a>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        <script>
            $(()=>
            {
                let f = null ; 
                let b = false ; 
                $( "#ps" ).on( "input" , () =>
                {
                    switch( $( "#ps" ).val() )
                    {
                        case 'A':
                            $( "#svg" ).attr( "viewBox" , "0 0 36 52" ) ; 
                            b = true ; 
                            $( "#color" ).attr( "disabled" , "" ) ; 
                            $( "#fr" ).attr( "disabled" , "" ) ; 
                            $( "#vb" ).attr( "disabled" , "" ) ; 
							$( "#vb" ).val( "0 0 36 52" ) ; 
                            break;
                        case "none":
                            b = false ; 
                            $( "#color" ).removeAttr( "disabled" ) ; 
                            $( "#fr" ).removeAttr( "disabled" ) ; 
                            $( "#vb" ).removeAttr( "disabled" ) ; 
                            break;
                        default:
                            break;
                    }
                } ) ; 
                $( "#in" ).on( "input" , () => 
                {
                    $( "#in" ).attr( "placeholder" , "path" ) ; 
                    $( "#preview" ).attr( "d" , $( "#in" ).val() ) ; 
                } ) ; 
                $( "#color" ).on( "input" , () => 
                {
                    $( "#svg" ).attr( "fill" , $( "#color" ).val() ) ; 
                } ) ; 
                $( "#fr" ).on( "input" , () => 
                {
                    $( "#svg" ).attr( "fill-rule" , $( "#fr" ).val() ) ; 
                } ) ; 
                $( "#vb" ).on( "input" , () => 
                {
                    $( "#svg" ).attr( "viewBox" , ($( "#vb" ).val() == null || $( "#vb" ).val() == "") ? "0 0 24 24" : $( "#vb" ).val() ) ; 
                } ) ; 
                $( "#create" ).on( "click" , () => 
                {
                    let str;
                    if( b )
                    {
                        // AQCST 未完
                        let re = /([MLT])\s*([0-9]+|[0-9]*\.[0-9]+)\s+([0-9]+|[0-9]*\.[0-9]+)/g ; 
                        let reg = /([HV])\s*([0-9]*\.[0-9]+|[0-9]+)/g ; 
                        let def = $( "#in" ).val().replace( re , ( m , mm1 , mm2 , mm3 ) => 
                        {
                            return mm1 + ( Number( mm2 ) + 10 ).toString() + " " + ( Number( mm3 ) + 10 ).toString() ; 
                        }) ; 
                        def = def.replace( reg , ( m , mm1 , mm2 ) => 
                        {
                            return mm1 + ( Number( mm2 ) + 10 ).toString() ; 
                        }) ; 
                        def += "\r\n\r\nM0 0h56v82h-56v-82l10 10h36v62h-36v-62z" ; 
                        str = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 82" fill="#f00" fill-rule="evenodd">\r\n\t<path d="' + def + '"/>\r\n</svg>' ; 
                    }
                    else 
                    {
                        str = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="' + ( ( $( "#vb" ).val() == null || $( "#vb" ).val() == "" ) ? "0 0 24 24" : $( "#vb" ).val() ) + '" fill=" ' + $( "#color" ).val() + '" fill-rule="' + ( ( $( "#fr" ).val() == null || $( "#fr" ).val() == "" ) ? "evenodd" : $( "#fr" ).val() ) + '">\r\n\t<path d="' + $( "#in" ).val() + '"/>\r\n</svg>' ; 
                    }
                    let d = new Blob( [ str ] , { type : "image/svg+xml" } ) ; 
                    if( f !== null ) 
                    {
                        window.URL.revokeObjectURL( f ) ; 
                    }
                    f = window.URL.createObjectURL( d ) ; 
                    // window.location.replace( f ) ; 
                    $( "#save" ).attr( "href" , f ) ;  
                } ) ; 
            } ) ; 
        </script>
    </body>
</html>
